digraph architecture {
  node [style=rounded,style=filled,fontname=Verdana,fontsize=12,colorscheme=pastel18,color=1];
  edge [color=darkgreen,fontname="Verdana",fontsize=10];
  graph [ dpi = 300 ];
  compound=true;

  fontname=Verdana;
  fontsize=12;
  main_process [label="main process"];
  input_file [label="4096x4096.in"];
  output_file [label="4096x4096.out"];
  main_process -> input_file [label="read"];
  main_process -> output_file [label="write"];

  column_transformation [label="First Column Transformation", shape=box, style="", color=0];
  image -> column_transformation [label="follows"];

  {
    edge [colorscheme=dark25,dir=both];
    node [colorscheme=dark25];

    subgraph cluster_row {
      label="First Row transformation"
      goroutine1 [color=1];
      goroutine2 [color=2];
      goroutineN [color=3];

      goroutine1 -> image [style=invis];
      goroutine2 -> image [style=invis];
      goroutineN -> image [style=invis];

      image [color=1,colorscheme=pastel18,shape=record, label="{
      {<A>(1,1)|<B>(1,2)|...|<A_half>(1,2048)|<A_half2>(1,2049) |...|<Z>(1,4096)} |
      {<A1>(2,1)|<B1>(2,1)|... | <A1_half>(2,2048) | <A1_half2>(2,2049) | ... |<Z1>(2,4096)} |
      {...} |
      {<A3>(4096,1)|<B3>(4096,2)| ... | <A3_half>(4096,2048) | <A3_half2> (4096,2049) | ... |<Z3>(4096,4096)} |
      Image}"];
    }

    image:A -> image:A_half [color=1];
    image:B -> image:A_half2 [color=1];

    image:A1 -> image:A1_half [color=2];
    image:B1 -> image:A1_half2 [color=2];

    image:A3 -> image:A3_half [color=3];
    image:B3 -> image:A3_half2 [color=3];
  }

  wait_group [label="wg sync.WaitGroup"]
  main_process -> wait_group [label="wg.Wait()", dir="back"];
  wait_group -> goroutine1 [label="wg.Done()", dir="back"];
  wait_group -> goroutine2 [label="wg.Done()", dir="back"];
  wait_group -> goroutineN [label="wg.Done()", dir="back"];
}
